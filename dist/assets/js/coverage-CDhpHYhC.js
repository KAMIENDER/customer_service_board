import{C as t,r as e,l as n,i as a,g as s,s as o,a as i,b as r}from"./api-fqDCxL2z.js";const c={coverageRate:{value:91}},l={labels:["1æœˆ16æ—¥","1æœˆ17æ—¥","1æœˆ18æ—¥","1æœˆ19æ—¥","1æœˆ20æ—¥","1æœˆ21æ—¥","1æœˆ22æ—¥"],answered:[5800,6200,6500,5900,6400,7e3,6500],unanswered:[700,800,650,750,600,550,600]},d=[{id:1,name:"è®¢å•çŠ¶æ€æŸ¥è¯¢",category:"å”®å/ç‰©æµ",volume:12402,volumeTrend:"è¿‘7æ—¥",coverageRate:98,status:"optimized",issues:[]},{id:2,name:"é€€æ¢è´§æ”¿ç­–",category:"å”®å‰/æ”¿ç­–",volume:5210,volumeTrend:"è¿‘7æ—¥",coverageRate:64,status:"warning",issues:["å¾ªç¯é—®ç­”","ç­–ç•¥ä¸åŒ¹é…"]},{id:3,name:"å‘è‰²éœ€æ±‚å’¨è¯¢",category:"æœªåˆ†ç±»",volume:892,volumeTrend:"ä¸Šå‡ä¸­",coverageRate:12,status:"danger",issues:["åœºæ™¯æœªå¼€å¯"]},{id:4,name:"ä¼˜æƒ æ´»åŠ¨å’¨è¯¢",category:"å”®å‰/ä¿ƒé”€",volume:3400,volumeTrend:"ç¨³å®š",coverageRate:88,status:"optimized",issues:[]},{id:5,name:"ç”¨æˆ·å‘é€å›¾ç‰‡",category:"é€šç”¨/åª’ä½“",volume:1105,volumeTrend:"è¿‘7æ—¥",coverageRate:45,status:"danger",issues:["è¯†åˆ«å¤±è´¥"]}],u=[{type:"äº§å“ä½¿ç”¨é—®é¢˜",example:"è¿™æ¬¾äº§å“æ€ä¹ˆä½¿ç”¨ï¼Ÿ",status:"è¯æœ¯ä¸å®Œæ•´",statusClass:"warning",frequency:856},{type:"å‘è‰²å’¨è¯¢",example:"ç™½é‡‘å‘è‰²åº”è¯¥æ€ä¹ˆå¤„ç†ï¼Ÿ",status:"ç¼ºå°‘åœºæ™¯",statusClass:"danger",frequency:523},{type:"ä¿ƒé”€æ´»åŠ¨",example:"ç°åœ¨æœ‰ä»€ä¹ˆä¼˜æƒ æ´»åŠ¨ï¼Ÿ",status:"éœ€è¦æ›´æ–°",statusClass:"info",frequency:412},{type:"é…é€æ—¶æ•ˆ",example:"å‘è´§åå‡ å¤©èƒ½åˆ°ï¼Ÿ",status:"è¯æœ¯ä¸å®Œæ•´",statusClass:"warning",frequency:389}];t.register(...e);let g={interval:7};const m=n();async function v(t=g){["stat-total-questions","stat-answered","stat-coverage-rate"].forEach(t=>{const e=document.getElementById(t);e&&(e.innerHTML='<span class="loading-spinner"></span>',e.classList.add("loading"))});try{const e=await s(t);if(e&&0===e.code&&e.data){const t=e.data,n=void 0!==t.all_question_num?t.all_question_num:t.question_num,a=t.answer_question_num;if(void 0!==n?f("stat-total-questions",0,n,1500):y("stat-total-questions","--"),void 0!==a?f("stat-answered",0,a,1500):y("stat-answered","--"),n&&void 0!==a){y("stat-coverage-rate",(a/n*100).toFixed(2))}else y("stat-coverage-rate","--")}else p()}catch(e){p()}["stat-total-questions","stat-answered","stat-coverage-rate"].forEach(t=>{const e=document.getElementById(t);e&&e.classList.remove("loading")})}function p(){y("stat-total-questions","--"),y("stat-answered","--"),y("stat-coverage-rate","--")}function y(t,e){const n=document.getElementById(t);n&&(n.textContent=e)}function f(t,e,n,a){const s=document.getElementById(t);if(!s)return;const o=n-e,i=performance.now();requestAnimationFrame(function t(n){const r=n-i,c=Math.min(r/a,1),l=1-Math.pow(1-c,4),d=Math.floor(e+o*l);s.textContent=d.toLocaleString(),c<1&&requestAnimationFrame(t)})}function b(t){return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`}function h(t){const e=new Date(t);return`${e.getMonth()+1}/${e.getDate()}`}m&&(g=m),document.addEventListener("DOMContentLoaded",function(){a(),v(),function(){const e=document.getElementById("coverageChart");if(!e)return;const n=l;new t(e,{type:"bar",data:{labels:n.labels,datasets:[{label:"å·²å›å¤",data:n.answered,backgroundColor:"rgba(16, 185, 129, 0.8)",borderRadius:4,barPercentage:.6},{label:"æœªå›å¤",data:n.unanswered,backgroundColor:"rgba(239, 68, 68, 0.6)",borderRadius:4,barPercentage:.6}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top",align:"end",labels:{usePointStyle:!0,pointStyle:"circle",padding:20,font:{size:12}}},tooltip:{backgroundColor:"rgba(255, 255, 255, 0.95)",titleColor:"#1F2937",bodyColor:"#6B7280",borderColor:"#E5E7EB",borderWidth:1,cornerRadius:8,padding:12}},scales:{x:{stacked:!0,grid:{display:!1},ticks:{color:"#9CA3AF",font:{size:11}}},y:{stacked:!0,beginAtZero:!0,grid:{color:"rgba(0, 0, 0, 0.05)"},ticks:{color:"#9CA3AF",font:{size:11},callback:t=>t>=1e3?t/1e3+"k":t}}}}})}(),function(){const t=document.querySelector(".circular-progress .progress");if(!t)return;const e=c,n=2*Math.PI*70,a=n-e.coverageRate.value/100*n;t.style.strokeDasharray=n,t.style.strokeDashoffset=n,setTimeout(()=>{t.style.strokeDashoffset=a},500),document.getElementById("coverage-rate").textContent=e.coverageRate.value}(),function(){const t=document.getElementById("scene-table-body");if(!t)return;const e=["ğŸ“¦","ğŸ”„","ğŸ’‡","ğŸ","ğŸ–¼ï¸"],n=["blue","purple","orange","green","red"];d.forEach((a,s)=>{const o=document.createElement("tr"),i=a.coverageRate>=80?"green":a.coverageRate>=50?"orange":"red",r="optimized"===a.status?"å·²ä¼˜åŒ–":"warning"===a.status?"éœ€ä¼˜åŒ–":"å¾…å¤„ç†",c="optimized"===a.status?"success":"warning"===a.status?"warning":"danger",l=a.issues.length>0?a.issues.map(t=>`<span class="tag warning">${t}</span>`).join(" "):`<span class="tag ${c}">${r}</span>`,d="optimized"===a.status?"æŸ¥çœ‹è¯æœ¯":"ç¼–è¾‘è¯æœ¯",u="optimized"===a.status?"":"primary";o.innerHTML=`\n      <td>\n        <div style="display: flex; align-items: center;">\n          <div class="category-icon ${n[s%n.length]}">${e[s%e.length]}</div>\n          <div>\n            <div class="table-cell-main">${a.name}</div>\n            <div class="table-cell-sub">${a.category}</div>\n          </div>\n        </div>\n      </td>\n      <td>\n        <div class="table-cell-main">${a.volume.toLocaleString()}</div>\n        <div class="table-cell-sub">${a.volumeTrend}</div>\n      </td>\n      <td>\n        <div style="display: flex; align-items: center; gap: 8px;">\n          <span style="font-weight: 600;">${a.coverageRate}%</span>\n          <div class="mini-progress">\n            <div class="fill ${i}" style="width: ${a.coverageRate}%"></div>\n          </div>\n        </div>\n      </td>\n      <td>${l}</td>\n      <td>\n        <button class="btn-outline ${u}">${d}</button>\n      </td>\n    `,t.appendChild(o)})}(),function(){const t=document.getElementById("script-table-body");if(!t)return;u.forEach(e=>{const n=document.createElement("tr");n.innerHTML=`\n      <td>\n        <div class="table-cell-main">${e.type}</div>\n      </td>\n      <td>\n        <div class="table-cell-sub" style="color: var(--text-primary);">"${e.example}"</div>\n      </td>\n      <td><span class="tag ${e.statusClass}">${e.status}</span></td>\n      <td style="font-weight: 600;">${e.frequency}</td>\n      <td><a href="#" class="link-text">ç¼–è¾‘è¯æœ¯</a></td>\n    `,t.appendChild(n)})}(),async function(){await $(1)}(),function(){const t=document.getElementById("chat-modal"),e=document.getElementById("chat-modal-close"),n=document.getElementById("questions-table-body");if(!t)return;e&&e.addEventListener("click",()=>{t.classList.remove("show")});t.addEventListener("click",e=>{e.target===t&&t.classList.remove("show")}),n&&n.addEventListener("click",async e=>{const n=e.target.closest("[data-conversation-id]");if(n){e.preventDefault();const a=n.dataset.conversationId;t.classList.add("show"),await async function(t){const e=document.getElementById("chat-content"),n=document.getElementById("chat-info");if(!e)return;e.innerHTML='<div style="text-align: center; color: #9CA3AF; margin-top: 40px;">åŠ è½½ä¸­...</div>',n&&(n.textContent=`ä¼šè¯ ID: ${t}`);try{const n=await r(t);if(n&&0===n.code&&n.data){let t=[];n.data.contents&&Array.isArray(n.data.contents)?t=n.data.contents:Array.isArray(n.data)?t=n.data:n.data.messages&&Array.isArray(n.data.messages)&&(t=n.data.messages),function(t,e){try{if(e.innerHTML="",!t||0===t.length)return void(e.innerHTML='<div style="text-align: center; color: #9CA3AF; margin-top: 40px;">æš‚æ— å¯¹è¯è®°å½•(åˆ—è¡¨ä¸ºç©º)</div>');t.forEach(t=>{const n=t.msg||t.content||t.message||"",a=t.gmtCreated||t.created_at||t.time||"",s=t.userNickFrom||t.sender||t.role||"",o=t.type||"text";let i="buyer";const r=String(s).toLowerCase();(r.includes("æ——èˆ°åº—")||r.includes("ä¸“å–åº—")||r.includes("å®¢æœ")||r.includes("colorlomo")||"ai"===r||"seller"===r||"assistant"===r)&&(i="seller","ai"===r&&(i="ai"));const c="buyer"===i?"ğŸ‘¤":"ai"===i?"ğŸ¤–":"ğŸ‘¨â€ğŸ’¼";let l=n;if("item_goods"===o||"sys_goods"===o){l=`<div style="font-size: 13px; color: #4B5563; border-left: 3px solid #E5E7EB; padding-left: 8px;">\n            <span style="color: #6B7280; font-weight: 500;">[å•†å“é“¾æ¥]</span><br/>${String(n).replace(/^å‘é€ä¸‹è¿°å•†å“é“¾æ¥:\s*/,"")}\n          </div>`}const d=document.createElement("div");d.className=`chat-message ${i}`,d.innerHTML=`\n         <div class="chat-avatar" title="${s}">${c}</div>\n         <div>\n           <div class="chat-bubble">${l||"[æ— å†…å®¹]"}</div>\n           ${a?`<div class="chat-time">${a}</div>`:""}\n         </div>\n       `,e.appendChild(d)}),setTimeout(()=>{e.scrollTop=e.scrollHeight},100)}catch(n){e.innerHTML=`<div style="text-align: center; color: #EF4444; margin-top: 40px;">æ¸²æŸ“é”™è¯¯: ${n.message}</div>`}}(t,e)}else e.innerHTML=`<div style="text-align: center; color: #EF4444; margin-top: 40px;">åŠ è½½å¤±è´¥: ${(null==n?void 0:n.message)||"æ•°æ®æ ¼å¼é”™è¯¯"}</div>`}catch(a){e.innerHTML=`<div style="text-align: center; color: #EF4444; margin-top: 40px;">è¯·æ±‚å¤±è´¥: ${a.message}</div>`}}(a)}})}(),function(){const t=document.querySelectorAll(".date-btn:not(.date-custom-btn)"),e=document.querySelector(".date-custom-btn"),n=document.getElementById("date-picker-dropdown"),a=document.getElementById("date-picker-cancel"),s=document.getElementById("date-picker-confirm"),i=document.getElementById("date-start"),r=document.getElementById("date-end"),c=new Date,l=new Date(c);l.setDate(c.getDate()-7),r&&(r.value=b(c));i&&(i.value=b(l));if((null==g?void 0:g.start_time)&&(null==g?void 0:g.end_time)){const t=String(g.start_time).split(" ")[0],n=String(g.end_time).split(" ")[0];i&&(i.value=t),r&&(r.value=n),document.querySelectorAll(".date-btn").forEach(t=>t.classList.remove("active")),e&&(e.classList.add("active","has-range"),e.textContent=`${h(t)} - ${h(n)}`)}else if("number"==typeof(null==g?void 0:g.interval)){const e=`${g.interval}days`,n=Array.from(t).find(t=>t.dataset.range===e);n&&(document.querySelectorAll(".date-btn").forEach(t=>t.classList.remove("active")),n.classList.add("active"))}t.forEach(t=>{t.addEventListener("click",async function(){document.querySelectorAll(".date-btn").forEach(t=>t.classList.remove("active")),this.classList.add("active"),n&&n.classList.remove("show"),e&&(e.textContent="è‡ªå®šä¹‰",e.classList.remove("has-range"));const t=this.dataset.range;if("yesterday"===t){const t=new Date,e=new Date(t);e.setDate(t.getDate()-1);const n=b(e);g={start_time:`${n} 00:00:00`,end_time:`${n} 23:59:59`}}else if(t.endsWith("days")){const e=parseInt(t);g={interval:e}}else g={interval:t};o(g),await v(g),await $(1)})}),e&&e.addEventListener("click",function(t){t.stopPropagation(),n&&n.classList.toggle("show")});a&&a.addEventListener("click",function(){n&&n.classList.remove("show")});s&&s.addEventListener("click",async function(){const t=null==i?void 0:i.value,a=null==r?void 0:r.value;t&&a&&(document.querySelectorAll(".date-btn").forEach(t=>t.classList.remove("active")),e&&(e.classList.add("active","has-range"),e.textContent=`${h(t)} - ${h(a)}`),g={start_time:`${t} 00:00:00`,end_time:`${a} 23:59:59`},o(g),await v(g),await $(1)),n&&n.classList.remove("show")});document.addEventListener("click",function(t){!n||n.contains(t.target)||(null==e?void 0:e.contains(t.target))||n.classList.remove("show")})}(),function(){const t=document.querySelectorAll(".filter-tab");t.forEach(e=>{e.addEventListener("click",function(){t.forEach(t=>t.classList.remove("active")),this.classList.add("active")})})}()});let E={currentPage:1,pageSize:20,totalCount:0};async function $(t){const e=document.getElementById("questions-table-body"),n=document.getElementById("questions-pagination");if(!e)return;E.currentPage=t;const a=(t-1)*E.pageSize;e.innerHTML='<tr><td colspan="5" style="text-align: center; color: #9CA3AF;">åŠ è½½ä¸­...</td></tr>';try{const t=await i({...g,offset:a,limit:E.pageSize});if(t&&0===t.code&&t.data&&t.data.questions){const a=t.data.questions,s=t.data.all_num||a.length;if(E.totalCount=s,e.innerHTML="",0===a.length)return e.innerHTML='<tr><td colspan="5" style="text-align: center; color: #9CA3AF;">æš‚æ— æ•°æ®</td></tr>',void L(n,0,1);a.forEach(t=>{const n=document.createElement("tr"),a=t.created_at||"-";n.innerHTML=`\n          <td>\n            <div class="table-cell-main">${t.buyer_nick||"-"}</div>\n          </td>\n          <td>\n            <div class="table-cell-sub">${t.seller_nick||"-"}</div>\n          </td>\n          <td>\n            <span class="tag warning">${t.reason||"æœªçŸ¥åŸå› "}</span>\n          </td>\n          <td>\n            <div class="table-cell-sub">${a}</div>\n          </td>\n          <td>\n            <a href="#" class="link-text" data-conversation-id="${t.conversation_id}">æŸ¥çœ‹å¯¹è¯</a>\n          </td>\n        `,e.appendChild(n)});L(n,s,Math.ceil(s/E.pageSize))}else e.innerHTML='<tr><td colspan="5" style="text-align: center; color: #EF4444;">åŠ è½½å¤±è´¥</td></tr>',n&&(n.innerHTML='<span class="pagination-info">åŠ è½½å¤±è´¥</span>')}catch(s){e.innerHTML='<tr><td colspan="5" style="text-align: center; color: #EF4444;">åŠ è½½å¤±è´¥: '+s.message+"</td></tr>",n&&(n.innerHTML='<span class="pagination-info">åŠ è½½å¤±è´¥</span>')}}function L(t,e,n){if(!t)return;const a=E.currentPage;let s=`<span class="pagination-info">æ˜¾ç¤º ${(a-1)*E.pageSize+1} è‡³ ${Math.min(a*E.pageSize,e)} å…± ${e} æ¡</span>`;s+=`<button class="page-btn" ${a<=1?"disabled":""} data-page="${a-1}">â€¹</button>`;let o=Math.max(1,a-2),i=Math.min(n,o+4);i-o<4&&(o=Math.max(1,i-4));for(let r=o;r<=i;r++)s+=`<button class="page-btn ${r===a?"active":""}" data-page="${r}">${r}</button>`;s+=`<button class="page-btn" ${a>=n?"disabled":""} data-page="${a+1}">â€º</button>`,t.innerHTML=s,t.querySelectorAll(".page-btn:not([disabled])").forEach(t=>{t.addEventListener("click",function(){const t=parseInt(this.dataset.page);t&&t!==a&&$(t)})})}
